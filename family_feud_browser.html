<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Family Feud – Laptop Edition</title>
<style>
body {
    margin: 0;
    padding: 0;
    background: #020d26;
    color: white;
    font-family: "Arial Black", sans-serif;
}
h1 {
    font-size: 4vw;
    color: #ffd700;
    text-align: center;
    margin: 10px 0;
    text-shadow: 2px 2px #000;
}
.board {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
}
#question {
    font-size: 2.5vw;
    margin: 20px 0;
}
.answers {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
}
.answer {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    background: #ffcc00;
    color: #020d26;
    font-weight: bold;
    border-radius: 10px;
    font-size: 2vw;
    cursor: pointer;
    perspective: 1000px;
}
.answer .front, .answer .back {
    width: 100%;
    display: flex;
    justify-content: space-between;
    backface-visibility: hidden;
    transition: transform 0.8s;
    padding: 0 10px;
}
.answer .back { transform: rotateY(180deg); }
.answer.revealed .front { transform: rotateY(180deg); }
.answer.revealed .back { transform: rotateY(0deg); }

input {
    font-size: 2vw;
    padding: 8px;
    width: 60%;
    margin: 10px 0;
}
button {
    font-size: 1.8vw;
    padding: 8px 16px;
    margin: 5px;
    border-radius: 8px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    background: #ffd700;
    color: #020d26;
}
.strike {
    font-size: 5vw;
    color: red;
    display: inline-block;
    margin: 0 10px;
    transition: transform 0.3s;
}
.team-score {
    font-size: 2.5vw;
    margin: 10px 0;
}
.current-team {
    font-size: 2vw;
    font-weight: bold;
    margin: 10px 0;
}
.final-result {
    font-size: 3vw;
    color: #00ff00;
    margin-top: 20px;
    text-align: center;
}

@keyframes pulseWin {
  0% { transform: scale(1); color: #00ff00; text-shadow: 1px 1px #000; }
  50% { transform: scale(1.2); color: #fff; text-shadow: 3px 3px #00ff00; }
  100% { transform: scale(1); color: #00ff00; text-shadow: 1px 1px #000; }
}
.win-pulse { animation: pulseWin 1s infinite; }

@keyframes winBgFlash {
  0% { background-color: #020d26; }
  50% { background-color: #004400; }
  100% { background-color: #020d26; }
}
.win-background { animation: winBgFlash 1s infinite; }

/* ========== ADMIN PANEL STYLES ========== */
.admin-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.92);
    z-index: 1000;
    overflow-y: auto;
}
.admin-overlay.active { display: block; }
.admin-panel {
    max-width: 900px;
    margin: 30px auto;
    padding: 30px;
    background: #1a1a2e;
    border-radius: 16px;
    border: 2px solid #ffd700;
    font-family: Arial, sans-serif;
}
.admin-panel h2 {
    color: #ffd700;
    text-align: center;
    margin-top: 0;
    font-size: 28px;
}
.admin-panel h3 {
    color: #ffcc00;
    margin: 20px 0 10px;
    font-size: 20px;
}
.admin-panel input, .admin-panel select {
    font-size: 16px;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #555;
    background: #0f0f23;
    color: #fff;
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 8px;
}
.admin-panel input:focus { outline: 2px solid #ffd700; }
.admin-panel button {
    font-size: 15px;
    padding: 10px 20px;
    margin: 5px;
    border-radius: 8px;
    font-weight: bold;
    border: none;
    cursor: pointer;
}
.admin-btn-primary { background: #ffd700; color: #020d26; }
.admin-btn-danger { background: #cc3333; color: #fff; }
.admin-btn-secondary { background: #555; color: #fff; }
.admin-btn-success { background: #28a745; color: #fff; }
.admin-question-card {
    background: #0f0f23;
    border: 1px solid #444;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 12px;
}
.admin-question-card .q-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
.admin-question-card .q-header span {
    color: #ffd700;
    font-weight: bold;
    font-size: 16px;
    flex: 1;
    margin-right: 10px;
}
.admin-answer-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 6px;
}
.admin-answer-row input { margin-bottom: 0; }
.admin-answer-row input:first-child { flex: 3; }
.admin-answer-row input:nth-child(2) { flex: 1; max-width: 100px; }
.admin-answer-row button { flex-shrink: 0; }
.admin-password-gate {
    text-align: center;
    padding: 60px 20px;
}
.admin-password-gate input {
    max-width: 300px;
    margin: 10px auto;
    display: block;
    text-align: center;
}
.admin-password-gate button {
    margin-top: 10px;
}
.admin-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #444;
}
.admin-edit-form {
    background: #162447;
    border: 1px solid #ffd700;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
}
.admin-edit-form h3 { margin-top: 0; }
.admin-msg {
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 10px;
    text-align: center;
    font-weight: bold;
}
.admin-msg-success { background: #28a74533; color: #28a745; border: 1px solid #28a745; }
.admin-msg-error { background: #cc333333; color: #cc3333; border: 1px solid #cc3333; }
</style>
</head>
<body>

<h1>FAMILY FEUD</h1>

<div class="board">
    <div class="team-score" id="teamScores">Team A: 0 | Team B: 0</div>
    <h2 id="question"></h2>
    <div class="answers" id="answers"></div>

    <div>Strikes</div>
    <div>Team A: <span id="strikesA"></span></div>
    <div>Team B: <span id="strikesB"></span></div>

    <div class="current-team" id="currentTeam"></div>

    <div>Time Left for Current Guess: <span id="roundTimer">30</span>s</div>

    <input id="guessInput" placeholder="Enter answer">
    <br>
    <button id="submitBtn" onclick="submitAnswer()">Submit</button>
    <button id="pauseBtn" onclick="togglePause()">Pause</button>

    <div class="controls">
        <button id="switchBtn" onclick="switchTeam()">Switch Team</button>
        <button id="nextBtn" onclick="nextQuestion()">Next Question</button>
        <button id="revealBtn" onclick="revealAll()">Reveal All</button>
        <button id="adminBtn" onclick="openAdmin()" style="background:#cc3333;color:#fff;">Admin Panel</button>
    </div>

    <div class="final-result" id="finalResult"></div>
</div>

<!-- ADMIN PANEL OVERLAY -->
<div class="admin-overlay" id="adminOverlay">
    <div class="admin-panel">
        <!-- Password Gate -->
        <div id="adminPasswordGate" class="admin-password-gate">
            <h2>ADMIN LOGIN</h2>
            <p style="color:#aaa;">Enter the admin password to manage questions.</p>
            <input type="password" id="adminPasswordInput" placeholder="Password" onkeydown="if(event.key==='Enter')checkAdminPassword()">
            <br>
            <button class="admin-btn-primary" onclick="checkAdminPassword()">Enter</button>
            <button class="admin-btn-secondary" onclick="closeAdmin()">Cancel</button>
            <div id="adminPasswordError"></div>
        </div>
        <!-- Main Admin Content (hidden until authenticated) -->
        <div id="adminContent" style="display:none;">
            <h2>QUESTION MANAGER</h2>
            <div id="adminMsg"></div>
            <div class="admin-toolbar">
                <div>
                    <button class="admin-btn-success" onclick="showAddForm()">+ Add New Question</button>
                    <button class="admin-btn-danger" onclick="deleteAllQuestions()">Delete All Questions</button>
                    <button class="admin-btn-secondary" onclick="resetToDefaults()">Reset to Defaults</button>
                </div>
                <div>
                    <button class="admin-btn-primary" onclick="saveAndClose()">Save &amp; Close</button>
                    <button class="admin-btn-secondary" onclick="closeAdmin()">Cancel</button>
                </div>
            </div>
            <!-- Add/Edit Form Area -->
            <div id="adminEditArea"></div>
            <!-- Question List -->
            <h3>Current Questions (<span id="adminQuestionCount">0</span>)</h3>
            <div id="adminQuestionList"></div>
        </div>
    </div>
</div>

<!-- SOUND EFFECTS -->
<audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-4.mp3"></audio>
<audio id="wrongSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>
<audio id="revealSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
<audio id="teamSwitchSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>

<script>
const defaultGameData = [
{

        question: "Who is the Tarsier in the Family?",
        answers: [
            { text: "Tita Ella", points: 20, revealed: false },
            { text: "Ate Anne", points: 12, revealed: false },
            { text: "Dr Joy", points: 8, revealed: false },
            { text: "Mommy Nene", points: 6, revealed: false },
            { text: "Judge Grace", points: 5, revealed: false },
            { text: "Ninang Glo", points: 4, revealed: false },
            { text: "Bastik", points: 2, revealed: false },
            { text: "All Girls", points: 1, revealed: false }
        ]
    },
    {
        question: "Who is the Quietest member?",
        answers: [
            { text: "Tito Adows", points: 15, revealed: false },
            { text: "Tito Basil", points: 12, revealed: false },
            { text: "None", points: 8, revealed: false },
            { text: "Tito Mon", points: 6, revealed: false },
            { text: "Vincent", points: 4, revealed: false },
            { text: "Nina", points: 3, revealed: false },
            { text: "Moana", points: 2, revealed: false }
        ]
    },
    {
        question: "Name a phrase or expression that Daddy Pepe is famous for saying.",
        answers: [
            { text: "whatever!", points: 20, revealed: false },
            { text: "my pabs", points: 16, revealed: false },
            { text: "ha! Ha!", points: 12, revealed: false },
            { text: "consistent lang", points: 7, revealed: false },
            { text: "Isa pa. pang delete", points: 5, revealed: false },
            { text: "Love, Daddy Pepe", points: 5, revealed: false },
            { text: "No Problem!", points: 3, revealed: false }
        ]
    },
    {
        question: "Name one Famous Song which is special to the Victoria Family",
        answers: [
            { text: "L-O-V-E", points: 20, revealed: false },
            { text: "Angelina", points: 18, revealed: false },
            { text: "My Girl/Dad", points: 14, revealed: false },
            { text: "I want it that way", points: 10, revealed: false },
            { text: "An Affair to Remember/A love Affair", points: 8, revealed: false },
            { text: "Tanging Yaman", points: 6, revealed: false },
            { text: "Sound of Music", points: 4, revealed: false }
        ]
    },
    {
        question: "Name One Skill that the Victoria Family will win a gold medal in?",
        answers: [
            { text: "Cooking", points: 15, revealed: false },
            { text: "Dancing", points: 10, revealed: false },
            { text: "Eating", points: 9, revealed: false },
            { text: "Debating", points: 7, revealed: false },
            { text: "Bashing", points: 5, revealed: false },
            { text: "Singing", points: 3, revealed: false },
            { text: "Best Dressed/Dressing Up", points: 2, revealed: false }
        ]
    },
    {
        question: "Name a food that is always present at our family gatherings",
        answers: [
            { text: "Fried Chicken", points: 20, revealed: false },
            { text: "Rice", points: 15, revealed: false },
            { text: "Kare-Kare", points: 13, revealed: false },
            { text: "Paes/Fish", points: 11, revealed: false },
            { text: "Longganisa", points: 10, revealed: false },
            { text: "Menudo", points: 8, revealed: false },
            { text: "Lechon", points: 7, revealed: false }
        ]
    },
    {
        question: "Name one item that can be found in Daddy Pepe's house.",
        answers: [
            { text: "pieta", points: 21, revealed: false },
            { text: "pictures", points: 16, revealed: false },
            { text: "rocking chair", points: 8, revealed: false },
            { text: "back scratcher/pangkamot", points: 4, revealed: false },
            { text: "hospital bed", points: 4, revealed: false },
            { text: "hats", points: 3, revealed: false }
        ]
    },
    {
        question: "Name a reason why a family gathering might go past midnight?",
        answers: [
            { text: "Stories/Chikahan", points: 12, revealed: false },
            { text: "Drinks/Inuman", points: 10, revealed: false },
            { text: "Karaoke/Videoke", points: 8, revealed: false },
            { text: "Movies/Netflix/Horror Movies", points: 6, revealed: false },
            { text: "Board Games", points: 5, revealed: false },
            { text: "Food", points: 4, revealed: false }
        ]
    },
    {
        question: "If the Family started a singing group, who would be the lead singer?",
        answers: [
            { text: "Tita Bong", points: 12, revealed: false },
            { text: "Korina", points: 10, revealed: false },
            { text: "Dr Joy", points: 8, revealed: false },
            { text: "Ate Anne", points: 6, revealed: false },
            { text: "Aimee", points: 6, revealed: false },
            { text: "Amanda", points: 6, revealed: false }
        ]
    },
    {
        question: "Who is the \"official photographer\" of the family?",
        answers: [
            { text: "Tita Ella", points: 17, revealed: false },
            { text: "Tito Ben", points: 12, revealed: false },
            { text: "Tita Bong", points: 10, revealed: false },
            { text: "Dr Joy", points: 8, revealed: false },
            { text: "Tito Jess", points: 6, revealed: false },
            { text: "Justin", points: 4, revealed: false }
        ]
    },
    {
        question: "Which family member is most likely to start a Karaoke session?",
        answers: [
            { text: "Tita Bong", points: 20, revealed: false },
            { text: "Korina/Jenny", points: 18, revealed: false },
            { text: "Aimee", points: 8, revealed: false },
            { text: "Tita May", points: 6, revealed: false },
            { text: "Ryanne", points: 4, revealed: false }
        ]
    },
    {
        question: "Name a specific gift or pasalubong you'd expect from a family member coming home from abroad?",
        answers: [
            { text: "chocolates", points: 14, revealed: false },
            { text: "keychain", points: 10, revealed: false },
            { text: "magnet", points: 8, revealed: false },
            { text: "vitamins", points: 6, revealed: false },
            { text: "ziplock/cling wrap", points: 4, revealed: false }
        ]
    },
    {
        question: "What is the most common/classic profession within the Victoria family?",
        answers: [
            { text: "Teacher/Education", points: 20, revealed: false },
            { text: "Lawyer/Law", points: 15, revealed: false },
            { text: "Accountant/Accounting", points: 10, revealed: false },
            { text: "Government/Civil Service", points: 6, revealed: false }
        ]
    },
    {
        question: "Name the family member who is most likely to win a debate or argument.",
        answers: [
            { text: "Judge Grace", points: 14, revealed: false },
            { text: "Tito Jess", points: 13, revealed: false },
            { text: "Atty Glo", points: 8, revealed: false },
            { text: "Atty Kix", points: 7, revealed: false }
        ]
    },
    {
        question: "What is the one thing which a family member living abroad misses the most?",
        answers: [
            { text: "Food/Kainan", points: 20, revealed: false },
            { text: "Family/Bonding", points: 18, revealed: false },
            { text: "Christmas", points: 15, revealed: false }
        ]
    },
    {
        question: "Who is the funniest family member?",
        answers: [
            { text: "Kix/Kiko/Francis", points: 10, revealed: false },
            { text: "Jess", points: 10, revealed: false },
            { text: "Jovy", points: 5, revealed: false }
        ]
    },
    {
        question: "Who is the family \"tech support\" - the person everyone goes to when their phone or wifi isn't working?",
        answers: [
            { text: "Tito Jess", points: 12, revealed: false },
            { text: "Justin", points: 10, revealed: false },
            { text: "Jewel", points: 8, revealed: false }
        ]
    },
    {
        question: "Name a country, other than the Philippines, where many of our relatives live.",
        answers: [
            { text: "Canada", points: 15, revealed: false },
            { text: "Australia", points: 12, revealed: false }
        ]
    }
];

// Load from localStorage if saved, otherwise use defaults
let gameData = JSON.parse(localStorage.getItem('familyFeudQuestions')) || JSON.parse(JSON.stringify(defaultGameData));

let currentQuestionIndex = 0;
let currentTeam = "A";
let strikes = {A:0, B:0};
let teamPoints = {A:0, B:0};
const maxStrikes = 3;
let roundTime = 30; 
let timerInterval;
let timerPaused = false;

const correctSound = document.getElementById("correctSound");
const wrongSound = document.getElementById("wrongSound");
const revealSound = document.getElementById("revealSound");
const teamSwitchSound = document.getElementById("teamSwitchSound");

function loadQuestion() {
    const q = gameData[currentQuestionIndex];
    q.answers.forEach(a=>a.revealed=false);
    strikes={A:0,B:0};
    document.getElementById("finalResult").innerText="";
    document.body.classList.remove("win-background");
    renderBoard();
    resetTimer();
}

function renderBoard() {
    const q = gameData[currentQuestionIndex];
    document.getElementById("question").innerText = q.question;

    const answersDiv = document.getElementById("answers");
    answersDiv.innerHTML="";
    q.answers.forEach((a,i)=>{
        const div=document.createElement("div");
        div.className="answer "+(a.revealed?"revealed":"");
        div.innerHTML=`<div class="front"><span>${i+1}. __________</span><span>${a.points}</span></div>
                       <div class="back"><span>${i+1}. ${a.text.toUpperCase()}</span><span>${a.points}</span></div>`;
        answersDiv.appendChild(div);
    });

    ["A","B"].forEach(t=>{
        document.getElementById("strikes"+t).innerHTML="❌ ".repeat(strikes[t]);
    });

    document.getElementById("currentTeam").innerText=`Current Team: Team ${currentTeam}`;
    document.getElementById("teamScores").innerText=`Team A: ${teamPoints.A} | Team B: ${teamPoints.B}`;
}

document.getElementById("guessInput").addEventListener("keydown", function(e){
    if(e.key==="Enter") submitAnswer();
});

/* ========== RELAXED MATCHING ========== */
function normalize(str){
    return str.toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();
}

function levenshtein(a,b){
    const matrix = Array.from({length:b.length+1},(_,i)=>[i]);
    for(let j=0;j<=a.length;j++) matrix[0][j]=j;
    for(let i=1;i<=b.length;i++){
        for(let j=1;j<=a.length;j++){
            matrix[i][j]=Math.min(
                matrix[i-1][j]+1,
                matrix[i][j-1]+1,
                matrix[i-1][j-1]+(a[j-1]===b[i-1]?0:1)
            );
        }
    }
    return matrix[b.length][a.length];
}

function similarity(a,b){
    const dist = levenshtein(a,b);
    return 1 - dist / Math.max(a.length,b.length);
}

function isRelaxedMatch(answer, guess){
    const a = normalize(answer);
    const g = normalize(guess);
    if(a.includes(g)) return true;  // partial match
    if(similarity(a,g) >= 0.6) return true; // fuzzy match
    return false;
}

function submitAnswer(){
    resetTimer(); 
    const input=document.getElementById("guessInput");
    const guess=input.value.trim();
    input.value="";
    if(!guess) return;

    const q=gameData[currentQuestionIndex];
    const match=q.answers.find(a=>!a.revealed && isRelaxedMatch(a.text, guess));

    if(match){
        match.revealed=true;
        teamPoints[currentTeam]+=match.points;
        correctSound.play(); renderBoard();
    }else{
        strikes[currentTeam]++;
        wrongSound.play();
        const el=document.getElementById("strikes"+currentTeam);
        el.style.transform="scale(1.5)";
        setTimeout(()=>el.style.transform="scale(1)",300);
        if(strikes[currentTeam]>=maxStrikes){ switchTeam();}
        renderBoard();
    }
}

function switchTeam(){
    currentTeam=currentTeam==="A"?"B":"A";
    teamSwitchSound.play(); renderBoard(); resetTimer();
}

function nextQuestion(){
    currentQuestionIndex++;
    if(currentQuestionIndex>=gameData.length){
        clearInterval(timerInterval);
        let winner="";
        if(teamPoints.A>teamPoints.B) winner="Team A Wins!";
        else if(teamPoints.B>teamPoints.A) winner="Team B Wins!";
        else winner="It's a Tie!";
        const finalEl=document.getElementById("finalResult");
        finalEl.innerText=`GAME OVER\n${winner}\nFinal Scores - Team A: ${teamPoints.A} | Team B: ${teamPoints.B}`;
        finalEl.classList.add("win-pulse");
        document.body.classList.add("win-background");
        document.getElementById("guessInput").disabled=true;
        document.querySelectorAll("button").forEach(b=>b.disabled=true);
        document.getElementById("currentTeam").innerText="GAME OVER";
        return;
    }
    loadQuestion(); 
}

function revealAll(){
    const q=gameData[currentQuestionIndex];
    q.answers.forEach(a=>a.revealed=true);
    revealSound.play(); renderBoard();
}

function startTimer(){
    document.getElementById("roundTimer").innerText = roundTime;
    clearInterval(timerInterval);
    timerPaused = false;
    timerInterval = setInterval(()=>{
        if(!timerPaused){
            roundTime--;
            document.getElementById("roundTimer").innerText = roundTime;
            if(roundTime <= 0){
                clearInterval(timerInterval);
                alert(`Time's up for Team ${currentTeam}! Counting as a wrong attempt.`);
                strikes[currentTeam]++;
                renderBoard();
                if(strikes[currentTeam]>=maxStrikes){ switchTeam(); }
                resetTimer(); 
            }
        }
    },1000);
}

function resetTimer(){
    roundTime = 30; 
    startTimer();
}

function togglePause(){
    timerPaused = !timerPaused;
    document.getElementById("pauseBtn").innerText = timerPaused ? "Resume" : "Pause";
}

/* ========== ADMIN PANEL ========== */
const ADMIN_PASSWORD = "daddypepe1931";
let adminAuthenticated = false;
let adminEditData = []; // working copy during admin session

function openAdmin() {
    clearInterval(timerInterval);
    document.getElementById("adminOverlay").classList.add("active");
    document.getElementById("adminPasswordGate").style.display = "block";
    document.getElementById("adminContent").style.display = "none";
    document.getElementById("adminPasswordInput").value = "";
    document.getElementById("adminPasswordError").innerHTML = "";
    adminAuthenticated = false;
    setTimeout(() => document.getElementById("adminPasswordInput").focus(), 100);
}

function closeAdmin() {
    document.getElementById("adminOverlay").classList.remove("active");
    adminAuthenticated = false;
    document.getElementById("adminEditArea").innerHTML = "";
    resetTimer();
}

function checkAdminPassword() {
    const input = document.getElementById("adminPasswordInput").value;
    if (input === ADMIN_PASSWORD) {
        adminAuthenticated = true;
        document.getElementById("adminPasswordGate").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        adminEditData = JSON.parse(JSON.stringify(gameData));
        renderAdminQuestionList();
    } else {
        document.getElementById("adminPasswordError").innerHTML =
            '<div class="admin-msg admin-msg-error">Incorrect password.</div>';
    }
}

function showAdminMsg(msg, type) {
    const el = document.getElementById("adminMsg");
    el.innerHTML = `<div class="admin-msg admin-msg-${type}">${msg}</div>`;
    setTimeout(() => el.innerHTML = "", 3000);
}

function renderAdminQuestionList() {
    document.getElementById("adminQuestionCount").innerText = adminEditData.length;
    const list = document.getElementById("adminQuestionList");
    list.innerHTML = "";
    if (adminEditData.length === 0) {
        list.innerHTML = '<p style="color:#aaa;text-align:center;">No questions yet. Click "+ Add New Question" to get started.</p>';
        return;
    }
    adminEditData.forEach((q, qi) => {
        const card = document.createElement("div");
        card.className = "admin-question-card";
        let answersHtml = q.answers.map((a, ai) =>
            `<div style="color:#ccc;font-size:14px;margin-left:16px;">
                ${ai + 1}. ${a.text} <span style="color:#ffd700;">(${a.points} pts)</span>
            </div>`
        ).join("");
        card.innerHTML = `
            <div class="q-header">
                <span>Q${qi + 1}: ${q.question}</span>
                <div>
                    <button class="admin-btn-primary" onclick="editQuestion(${qi})" style="font-size:13px;">Edit</button>
                    <button class="admin-btn-danger" onclick="deleteQuestion(${qi})" style="font-size:13px;">Delete</button>
                </div>
            </div>
            ${answersHtml}
        `;
        list.appendChild(card);
    });
}

function showAddForm() {
    showEditForm(-1);
}

function editQuestion(index) {
    showEditForm(index);
}

function showEditForm(index) {
    const isNew = index === -1;
    const q = isNew ? { question: "", answers: [{ text: "", points: 0 }] } : JSON.parse(JSON.stringify(adminEditData[index]));
    const area = document.getElementById("adminEditArea");

    function renderForm() {
        let answersHtml = q.answers.map((a, ai) => `
            <div class="admin-answer-row">
                <input type="text" value="${a.text.replace(/"/g, '&quot;')}" placeholder="Answer text"
                    onchange="this.dataset.val=this.value" data-val="${a.text.replace(/"/g, '&quot;')}" id="adminAnsText${ai}">
                <input type="number" value="${a.points}" placeholder="Points" min="0"
                    onchange="this.dataset.val=this.value" data-val="${a.points}" id="adminAnsPts${ai}">
                <button class="admin-btn-danger" onclick="adminRemoveAnswer(${ai})" style="font-size:12px;padding:6px 10px;" ${q.answers.length <= 1 ? 'disabled' : ''}>X</button>
            </div>
        `).join("");

        area.innerHTML = `
            <div class="admin-edit-form">
                <h3>${isNew ? "Add New Question" : "Edit Question"}</h3>
                <label style="color:#aaa;font-size:14px;">Question:</label>
                <input type="text" id="adminQuestionText" value="${q.question.replace(/"/g, '&quot;')}" placeholder="Enter the question">
                <label style="color:#aaa;font-size:14px;margin-top:10px;display:block;">Answers:</label>
                <div id="adminAnswersList">${answersHtml}</div>
                <button class="admin-btn-secondary" onclick="adminAddAnswer()" style="margin-top:8px;font-size:13px;">+ Add Answer</button>
                <div style="margin-top:15px;">
                    <button class="admin-btn-success" onclick="adminSaveQuestion(${index})">Save Question</button>
                    <button class="admin-btn-secondary" onclick="document.getElementById('adminEditArea').innerHTML='';">Cancel</button>
                </div>
            </div>
        `;
    }

    // Store q on window so helper functions can access it
    window._adminEditQ = q;
    window._adminEditRender = renderForm;
    renderForm();
    document.getElementById("adminQuestionText").focus();
}

function adminCollectCurrentAnswers() {
    const q = window._adminEditQ;
    // Read current values from DOM back into q
    q.question = document.getElementById("adminQuestionText").value;
    q.answers.forEach((a, ai) => {
        const textEl = document.getElementById("adminAnsText" + ai);
        const ptsEl = document.getElementById("adminAnsPts" + ai);
        if (textEl) a.text = textEl.value;
        if (ptsEl) a.points = parseInt(ptsEl.value) || 0;
    });
}

function adminAddAnswer() {
    adminCollectCurrentAnswers();
    window._adminEditQ.answers.push({ text: "", points: 0 });
    window._adminEditRender();
    // Focus the new answer field
    const newIdx = window._adminEditQ.answers.length - 1;
    setTimeout(() => {
        const el = document.getElementById("adminAnsText" + newIdx);
        if (el) el.focus();
    }, 50);
}

function adminRemoveAnswer(ai) {
    adminCollectCurrentAnswers();
    window._adminEditQ.answers.splice(ai, 1);
    window._adminEditRender();
}

function adminSaveQuestion(index) {
    adminCollectCurrentAnswers();
    const q = window._adminEditQ;

    // Validate
    if (!q.question.trim()) {
        showAdminMsg("Question text cannot be empty.", "error");
        return;
    }
    // Remove empty answers
    q.answers = q.answers.filter(a => a.text.trim() !== "");
    if (q.answers.length === 0) {
        showAdminMsg("You need at least one answer.", "error");
        return;
    }
    // Add revealed:false to all answers
    q.answers.forEach(a => a.revealed = false);

    if (index === -1) {
        adminEditData.push(q);
        showAdminMsg("Question added!", "success");
    } else {
        adminEditData[index] = q;
        showAdminMsg("Question updated!", "success");
    }
    document.getElementById("adminEditArea").innerHTML = "";
    renderAdminQuestionList();
}

function deleteQuestion(index) {
    if (!confirm(`Delete question "${adminEditData[index].question}"?`)) return;
    adminEditData.splice(index, 1);
    showAdminMsg("Question deleted.", "success");
    renderAdminQuestionList();
}

function deleteAllQuestions() {
    if (!confirm("Delete ALL questions? This cannot be undone.")) return;
    if (!confirm("Are you really sure? All questions will be removed.")) return;
    adminEditData = [];
    showAdminMsg("All questions deleted.", "success");
    renderAdminQuestionList();
}

function resetToDefaults() {
    if (!confirm("Reset all questions to the original defaults? Any custom questions will be lost.")) return;
    adminEditData = JSON.parse(JSON.stringify(defaultGameData));
    showAdminMsg("Questions reset to defaults.", "success");
    renderAdminQuestionList();
}

function saveAndClose() {
    // Commit adminEditData to gameData and localStorage
    gameData = JSON.parse(JSON.stringify(adminEditData));
    gameData.forEach(q => q.answers.forEach(a => a.revealed = false));
    localStorage.setItem('familyFeudQuestions', JSON.stringify(gameData));

    // Reset game state
    currentQuestionIndex = 0;
    currentTeam = "A";
    strikes = { A: 0, B: 0 };
    teamPoints = { A: 0, B: 0 };
    document.getElementById("guessInput").disabled = false;
    document.querySelectorAll("button").forEach(b => b.disabled = false);
    document.getElementById("finalResult").innerText = "";
    document.body.classList.remove("win-background");

    closeAdmin();
    if (gameData.length > 0) {
        loadQuestion();
    } else {
        document.getElementById("question").innerText = "No questions loaded. Open Admin Panel to add questions.";
        document.getElementById("answers").innerHTML = "";
    }
}

loadQuestion();
</script>

</body>
</html>
